{"version":3,"sources":["../webpack/bootstrap","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../../core/Simulation/mesh.js","../../core/Simulation/deserialize.js","../../../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../../core/Simulation/utils.js","../../core/Simulation/simulation.worker.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_defineProperty","obj","configurable","writable","ownKeys","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","_arrayLikeToArray","arr","len","arr2","Array","_unsupportedIterableToArray","minLen","toString","slice","constructor","from","test","_slicedToArray","isArray","iterator","_arr","_n","_d","_e","undefined","_s","_i","next","done","err","TypeError","_defineProperties","props","descriptor","_toConsumableArray","iter","findMeshes","allLinks","findLinkById","id","find","findInputs","meshLinks","map","link","port","input","findOutputs","meshes","isBifurcation","mainLink","mesh","addRecursively","bifurcation","bifurcations","links","inputs","outputs","GenericComponent","properties","methods","instance","Constructor","entries","method","this","initialize","configurations","protoProps","staticProps","ports","output","values","type","previous","current","meta","risingEdge","fallingEdge","setValues","every","portName","includes","reduce","event","MessageEvent","data","command","emitted","self","dispatchEvent","deserializeMethod","model","fromEntries","stringFn","Function","deserialize","serialized","models","deserializeModels","components","component","isValueValid","getComponent","circuit","appendComponentDiff","diff","getProperties","emitQueue","stepQueue","workInterval","addEventListener","diagram","setInputValues","setOutputValues","diffLinks","flat","diffComponents","postMessage","onSimulationStart","executeNextEmitted","setInterval","onSimulationPause","clearInterval","onSimulationStop","setTimeout","first","shift","emitter","propagate","executeNextStep","result","isInputValid","step","stepError","hasOutputChanged","some","meshInput","componentId","getAffectedMeshes","meshValue","allInputValues","portInfo","getOutputPort","getMeshInputValue","Set","meshOutput","portsWithNewValue"],"mappings":"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","file":"SimulationWorker.a337eedeea443fff512c.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"https://renato-bohler.github.io/logossim/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","/**\n * A \"mesh\" is a set of links that are connected to each other.\n *\n * (if there's a better technical name for this please let me know :P)\n *\n * This function receives all links and returns every mesh found,\n * containing the id of each link that makes part of it, as well as\n * a list of all input and output ports that those links connects to.\n *\n * The implementation is basically a DFS (depth first search) executed\n * on every link on the circuit that is not a bifurcation.\n */\nconst findMeshes = allLinks => {\n  // Auxiliary functions\n  const findLinkById = id => allLinks.find(l => id === l.id);\n\n  const addRecursively = (link, mesh) => {\n    if (!link || link.id in mesh) return;\n\n    // eslint-disable-next-line no-param-reassign\n    mesh[link.id] = true;\n\n    addRecursively(findLinkById(link.bifurcation.source), mesh);\n    addRecursively(findLinkById(link.bifurcation.target), mesh);\n    link.bifurcations.forEach(bifurcation =>\n      addRecursively(findLinkById(bifurcation), mesh),\n    );\n  };\n\n  // Output ports are inputs in the mesh's perspective\n  const findInputs = meshLinks =>\n    [\n      ...meshLinks.map(link => findLinkById(link).source),\n      ...meshLinks.map(link => findLinkById(link).target),\n    ].filter(port => port && !port.input);\n\n  // Input ports are outputs in the mesh's perspective\n  const findOutputs = meshLinks =>\n    [\n      ...meshLinks.map(link => findLinkById(link).source),\n      ...meshLinks.map(link => findLinkById(link).target),\n    ].filter(port => port && port.input);\n\n  // Start with no meshes\n  const meshes = [];\n\n  // For each link that is not a bifurcation\n  allLinks\n    .filter(link => !link.isBifurcation)\n    .forEach(mainLink => {\n      // If this link is already on a mesh, there's nothing to do\n      if (meshes.find(mesh => mainLink.id in mesh)) return;\n\n      // Otherwise, create a new mesh and recursively explore it\n      const mesh = {};\n      addRecursively(mainLink, mesh, allLinks);\n      meshes.push(mesh);\n    });\n\n  return meshes\n    .map(mesh => Object.keys(mesh))\n    .map(meshLinks => ({\n      links: meshLinks,\n      inputs: findInputs(meshLinks),\n      outputs: findOutputs(meshLinks),\n    }));\n};\n\nexport default findMeshes;\n","/**\n * SimulationWorker receives all components properties and methods\n * serialized. For that reason, we need to deserialize them before\n * executing the simulation thread.\n */\n\n/* ---------------------------------------------------------------- */\nimport findMeshes from './mesh';\n\n/**\n * This class represents a generic component. It receives deserialized\n * properties and methods in its constructor and it's used to handle\n * simulation logic.\n */\nexport class GenericComponent {\n  constructor(properties, methods) {\n    Object.entries(properties).forEach(([key, value]) => {\n      this[key] = value;\n    });\n\n    Object.entries(methods).forEach(([name, method]) => {\n      this[name] = method.bind(this);\n    });\n\n    this.initialize(properties.configurations);\n  }\n\n  getInputPort(name) {\n    return this.ports.input.find(port => port.name === name);\n  }\n\n  getOutputPort(name) {\n    return this.ports.output.find(port => port.name === name);\n  }\n\n  setValues(values, type) {\n    this.ports[type] = this.ports[type].map(port => {\n      const previous = port.value;\n\n      const current =\n        values[port.name] !== undefined\n          ? values[port.name]\n          : previous;\n\n      const risingEdge = previous === 0 && current === 1;\n      const fallingEdge = previous === 1 && current === 0;\n\n      return {\n        ...port,\n        value: current,\n        meta: {\n          previous,\n          risingEdge,\n          fallingEdge,\n        },\n      };\n    });\n  }\n\n  setInputValues(values) {\n    this.setValues(values, 'input');\n  }\n\n  setOutputValues(values) {\n    this.setValues(values, 'output');\n  }\n\n  hasOutputChanged(values) {\n    return !Object.keys(values).every(\n      portName =>\n        values[portName] ===\n        this.ports.output.find(output => output.name === portName)\n          .value,\n    );\n  }\n\n  getProperties() {\n    const customPropertyNames = Object.keys(this).filter(\n      key =>\n        !['id', 'initialize', 'configurations', 'ports'].includes(\n          key,\n        ),\n    );\n\n    return customPropertyNames\n      .filter(property => typeof this[property] !== 'function')\n      .reduce(\n        (obj, property) => ({ ...obj, [property]: this[property] }),\n        {},\n      );\n  }\n\n  // Defaults\n  onSimulationStart() {}\n\n  onSimulationPause() {}\n\n  onSimulationStop() {}\n\n  step() {\n    return {};\n  }\n\n  stepError() {\n    return this.ports.output.reduce(\n      (obj, port) => ({ ...obj, [port.name]: 'error' }),\n      {},\n    );\n  }\n\n  emit(value) {\n    const event = new MessageEvent('message', {\n      data: {\n        command: 'emit',\n        emitted: { from: this.id, value },\n      },\n    });\n\n    // eslint-disable-next-line no-restricted-globals\n    self.dispatchEvent(event);\n  }\n\n  // Diagram stubs\n  addInputPort() {}\n\n  addOutputPort() {}\n\n  removePort() {}\n}\n\n/**\n * Converts string representing functions to actual functions in given\n * model.\n */\nconst deserializeMethod = model =>\n  Object.fromEntries(\n    Object.entries(model.methods).map(([key, stringFn]) => [\n      key,\n      // eslint-disable-next-line no-new-func\n      new Function(\n        `return ${\n          /**\n           * We need to add the `function` token when on development\n           * environment.\n           */\n          process.env.NODE_ENV === 'development' ? 'function ' : ''\n        }${stringFn}`,\n      )(),\n    ]),\n  );\n\nconst deserializeModels = models =>\n  models\n    .map(model => ({\n      ...model,\n      methods: deserializeMethod(model),\n    }))\n    .reduce(\n      (obj, model) => ({\n        ...obj,\n        [model.type]: model.methods,\n      }),\n      {},\n    );\n\n/**\n * Deserialize a given diagram (serialized), generating\n * `GenericComponent` instances with its given methods and properties.\n */\nconst deserialize = serialized => {\n  const models = deserializeModels(serialized.models);\n\n  return {\n    components: serialized.components.map(\n      component =>\n        new GenericComponent(\n          {\n            ...component.properties,\n            id: component.id,\n            configurations: component.configurations,\n            ports: {\n              input: component.ports\n                .filter(port => port.input)\n                .map(port => ({\n                  ...port,\n                  value: 0,\n                })),\n              output: component.ports\n                .filter(port => !port.input)\n                .map(port => ({\n                  ...port,\n                  value: 0,\n                })),\n            },\n          },\n          models[component.type],\n        ),\n    ),\n    meshes: findMeshes(serialized.links),\n  };\n};\n\nexport default deserialize;\n","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","/* eslint-disable no-restricted-globals */\nexport const isValueValid = value =>\n  value === null || value === 0 || value === 1;\n\nexport const isInputValid = input =>\n  Object.values(input).every(isValueValid);\n\nexport const getCleanDiff = () => ({\n  components: {},\n  links: {},\n});\n\nexport const getComponent = id => {\n  if (!self.circuit) return null;\n\n  return (\n    self.circuit.components.find(component => component.id === id) ||\n    null\n  );\n};\n\n/**\n * Find all meshes that are affected by an emitted change.\n */\nexport const getAffectedMeshes = emitted =>\n  self.circuit.meshes.filter(mesh =>\n    mesh.inputs.some(\n      meshInput =>\n        emitted.from === meshInput.componentId &&\n        Object.keys(emitted.value).includes(meshInput.name),\n    ),\n  );\n\n/**\n * Finds all components that are connected on a given mesh's output.\n */\nexport const getMeshOutputComponents = mesh =>\n  [\n    ...new Set(\n      mesh.outputs.map(meshOutput => meshOutput.componentId),\n    ),\n  ].map(componentId => getComponent(componentId));\n\n/**\n * Determines the mesh input value.\n */\nexport const getMeshInputValue = mesh => {\n  const allInputValues = mesh.inputs\n    .map(portInfo => {\n      const component = self.circuit.components.find(\n        c => c.id === portInfo.componentId,\n      );\n\n      /**\n       * From the mesh's perspective, a component's output port is an\n       * input.\n       */\n      const port = component.getOutputPort(portInfo.name);\n\n      return port ? port.value : null;\n    })\n    .filter(value => value !== null);\n\n  // A mesh input is coherent if all of its inputs has the same value\n  const isCoherent = allInputValues.every(\n    (value, i, values) => value === values[0],\n  );\n\n  return isCoherent ? allInputValues[0] : 'error';\n};\n\n/**\n * Initialize all links and ports with the value 0.\n */\nexport const initializeDiffAndValues = () => {\n  self.circuit.components.forEach(component => {\n    component.setInputValues(\n      Object.fromEntries(\n        component.ports.input.map(port => [port.id, 0]),\n      ),\n    );\n    component.setOutputValues(\n      Object.fromEntries(\n        component.ports.output.map(port => [port.id, 0]),\n      ),\n    );\n  });\n\n  const diffLinks = self.circuit.meshes\n    .map(mesh => mesh.links)\n    .flat()\n    .reduce((obj, link) => ({ ...obj, [link]: 0 }), {});\n\n  const diffComponents = Object.fromEntries(\n    self.circuit.components.map(component => [\n      component.id,\n      {\n        output: Object.fromEntries(\n          [\n            ...component.ports.input,\n            ...component.ports.output,\n          ].map(port => [port.name, 0]),\n        ),\n        properties: component.getProperties(),\n      },\n    ]),\n  );\n\n  postMessage({\n    type: 'diff',\n    diff: { links: diffLinks, components: diffComponents },\n  });\n};\n\nexport const appendComponentDiff = (component, output) => {\n  if (!self.diff.components[component.id]) {\n    self.diff.components[component.id] = {\n      output: {},\n      properties: {},\n    };\n  }\n  self.diff.components[component.id] = {\n    ...self.diff.components[component.id],\n    output,\n    properties: component.getProperties(),\n  };\n};\n","/**\n * This code runs the simulation workload on a Web Worker thread, to\n * avoid blocking the UI (main) thread.\n *\n * Whenever a component executes `emit`, its changes are pushed to\n * `emitQueue`, which will be handled by the `executeNextEmitted`\n * function.\n *\n * Every component that is affected by this emitted event is pushed to\n * the `stepQueue`, which will be handled recursively by the\n * `executeNextStep` function.\n */\n\n/* ---------------------------------------------------------------- */\n\n/* eslint-disable no-restricted-globals */\n/* eslint-disable no-use-before-define */\nimport deserialize from './deserialize';\nimport {\n  getCleanDiff,\n  appendComponentDiff,\n  initializeDiffAndValues,\n  isInputValid,\n  getComponent,\n  getAffectedMeshes,\n  getMeshInputValue,\n  getMeshOutputComponents,\n} from './utils';\n\n/**\n * Worker states\n */\nself.circuit = null; // circuit information\nself.diff = null; // diff to send back to the app\nself.emitQueue = []; // emitted changes that are pending\nself.stepQueue = []; // components that are pending propagation\nself.workInterval = null; // main execution interval\n\n/**\n * Worker message handling\n */\nself.addEventListener(\n  'message',\n  ({ data: { command, diagram, emitted } }) => {\n    switch (command) {\n      /**\n       * START\n       */\n      case 'start':\n        if (diagram !== undefined) {\n          self.circuit = deserialize(diagram);\n          self.diff = getCleanDiff();\n          initializeDiffAndValues();\n        }\n\n        self.circuit.components.forEach(component =>\n          component.onSimulationStart(),\n        );\n\n        // Main workload\n        executeNextEmitted();\n        self.workInterval = setInterval(executeNextEmitted);\n        break;\n\n      /**\n       * PAUSE\n       */\n      case 'pause':\n        self.circuit.components.forEach(component =>\n          component.onSimulationPause(),\n        );\n        clearInterval(self.workInterval);\n        break;\n\n      /**\n       * STOP\n       */\n      case 'stop':\n        self.circuit.components.forEach(component =>\n          component.onSimulationStop(),\n        );\n        clearInterval(self.workInterval);\n        setTimeout(() => {\n          postMessage({ type: 'clear' });\n          self.circuit = null;\n          self.diff = null;\n          self.emitQueue = [];\n          self.stepQueue = [];\n        });\n        break;\n\n      /**\n       * EMIT\n       */\n      case 'emit':\n        if (self.circuit) self.emitQueue.push(emitted);\n        break;\n\n      default:\n        break;\n    }\n  },\n);\n\n/**\n * Handles the next emitted event on the emit queue and propagates it.\n */\nconst executeNextEmitted = (first = true) => {\n  if (!self.circuit) return;\n\n  const emitted = self.emitQueue.shift();\n  if (!emitted) return;\n\n  const emitter = getComponent(emitted.from);\n  emitter.setOutputValues(emitted.value);\n\n  appendComponentDiff(emitter, emitted.value);\n  propagate(emitted);\n  executeNextStep();\n\n  executeNextEmitted(false);\n\n  if (first) {\n    postMessage({ type: 'diff', diff: self.diff });\n    self.diff = getCleanDiff();\n  }\n};\n\n/**\n * Executes a step on the next component affected by the emitted\n * change that is being currently handled. Propagates this component's\n * change forward.\n */\nconst executeNextStep = () => {\n  const component = self.stepQueue.shift();\n  if (!component) return;\n\n  const input = component.ports.input.reduce(\n    (obj, port) => ({ ...obj, [port.name]: port.value }),\n    {},\n  );\n\n  const meta = component.ports.input.reduce(\n    (obj, port) => ({ ...obj, [port.name]: port.meta }),\n    {},\n  );\n\n  let result = {};\n  if (isInputValid(input)) {\n    result = component.step(input, meta);\n  } else {\n    result = component.stepError(input, meta);\n  }\n\n  if (!result) return;\n\n  const output = Object.fromEntries(\n    Object.entries(result).filter(([name]) =>\n      component.ports.output.find(o => o.name === name),\n    ),\n  );\n\n  if (component.hasOutputChanged(output)) {\n    component.setOutputValues(output);\n    appendComponentDiff(component, output);\n    propagate({ from: component.id, value: output });\n  }\n\n  executeNextStep();\n};\n\n/**\n * Propagates a change on a component to all components connected to\n * its output.\n */\nconst propagate = emitted => {\n  const affectedMeshes = getAffectedMeshes(emitted);\n  affectedMeshes.forEach(mesh => {\n    const meshValue = getMeshInputValue(mesh);\n    mesh.links.forEach(link => {\n      self.diff.links[link] = meshValue;\n    });\n\n    const connectedComponents = getMeshOutputComponents(mesh);\n    connectedComponents.forEach(component => {\n      const portsConnectedToMesh = mesh.outputs\n        .filter(meshOutput => meshOutput.componentId === component.id)\n        .map(meshOutput => meshOutput.name);\n\n      const portsWithNewValue = portsConnectedToMesh.reduce(\n        (obj, portName) => ({ ...obj, [portName]: meshValue }),\n        {},\n      );\n\n      component.setInputValues(portsWithNewValue);\n\n      appendComponentDiff(component, portsWithNewValue);\n\n      self.stepQueue.push(component);\n    });\n  });\n};\n"],"sourceRoot":""}